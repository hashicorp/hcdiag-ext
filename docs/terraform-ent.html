<!DOCTYPE html>
<html>

<head>
  <title>hcdiag-ext for Terraform Enterprise</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins|Inter|Roboto+Mono&display=swap" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <h1>hcdiag-ext for Terraform Enterprise</h1>
  <p>For more information about how this configuration works, <a href="https://github.com/hashicorp/hcdiag-ext">see the
      README</a>.</p>
  <div class="code-block">
    <pre>
<code>
# Copyright (c) HashiCorp, Inc.
# SPDX-License-Identifier: MPL-2.0

# Terraform Enterprise checks

host {
  selects = [":"] # noop to ensure no other default hcdiag host commands are auto-loaded
  shell {
    run = ":"
  }
}

product "terraform-ent" {
  selects = [
              "GET /api/v2/admin/release",
              "GET /api/v2/admin/runs?page%5Bsize%5D=1",
              "GET /api/v2/admin/workspaces?page%5Bsize%5D=1",
            ]

# check version
  GET {
    path = "/api/v2/admin/release"
  }

# check enterprise features in use
  GET {
    path = "/api/v2/admin/runs?page%5Bsize%5D=1"
  }

# check workspace count
  GET {
    path = "/api/v2/admin/workspaces?page%5Bsize%5D=1" 
    }
  }
</code>
    </pre>
  </div>
  <button class="terraform" onclick="downloadCode()">Download hcdiag-ext configuration file</button> or
  <button class="terraform" onclick="copyCode()">Copy to clipboard</button>
  <script>
    function downloadCode() {
      const code = document.querySelector(".code-block code").innerText;
      const blob = new Blob([code], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");

      link.setAttribute("href", url);
      link.setAttribute("download", "hcdiag_terraform.hcl");
      link.style.display = "none";

      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }
    function copyCode() {
      const code = document.querySelector(".code-block code").innerText;
      navigator.clipboard.writeText(code)
        .then(() => {
          alert('Code copied to clipboard');
        })
        .catch((error) => {
          console.error('Failed to copy code:', error);
        });
    }
  </script>
</body>

</html>
