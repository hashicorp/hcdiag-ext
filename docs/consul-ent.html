<!DOCTYPE html>
<html>

<head>
  <title>hcdiag-ext for Consul Enterprise</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins|Inter|Roboto+Mono&display=swap" />
  <link rel="stylesheet" href="css/normalize.css" />
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/main.js"></script>
</head>

<body>
  <h1>hcdiag-ext for Consul Enterprise</h1>
  <p>For more information about how this configuration works, <a href="https://github.com/hashicorp/hcdiag-ext">see the
      README</a>.</p>
  <div class="code-block">
    <pre>
<code>
# Copyright (c) HashiCorp, Inc.
# SPDX-License-Identifier: MPL-2.0

# Consul Enterprise checks

host {
  selects = [":"] # noop to ensure no other default hcdiag host commands are auto-loaded
  shell {
    run = ":"
  }
}

product "consul" {
  selects = [
              "GET /v1/agent/self",
              "GET /v1/catalog/services",
              "GET /v1/catalog/services?filter='ServiceName==%22consul-snapshot%22'",
              "GET /v1/operator/autopilot/configuration",
              "GET /v1/operator/license",
              "GET /v1/operator/usage?global=true"
            ]

# check consul version is recent
  GET {
    path = "/v1/agent/self"
  }

# get services list and count
  GET {
    path = "/v1/catalog/services"
  }

# check if consul snapshot service is running for automated backups
  GET {
    path = "/v1/catalog/services?filter='ServiceName==%22consul-snapshot%22'"
  }

# check autopilot is configured
  GET {
    path = "/v1/operator/autopilot/configuration"
  }
  
# check consul license
  GET {
    path = "/v1/operator/license"
  }

# check consul usage
  GET {
    path = "/v1/operator/usage?global=true"
  }
}
</code>
    </pre>
  </div>
  <button id="downloadCode" class="consul" onclick="downloadCode()">Download hcdiag-ext configuration file</button> or
  <button id="copyCode" class="consul" onclick="copyCode()">Copy to clipboard</button>
</body>

</html>
